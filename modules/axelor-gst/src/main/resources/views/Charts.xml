<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.0.xsd">

  <chart onInit="action-date-time-set-defalut" name="chart-unpaid-customer" title="Unpaid Invoice Per Customer">
    <search-fields>
      <field type="datetime" name="fromDateTime" title="from Date" />
      <field type="datetime" name="toDateTime" title="To Date" />
    </search-fields>

    <dataset type="jpql">
    <![CDATA[
   SELECT                  
        count(self.status) as status,
        party1.name as customer
    FROM
        Invoice as self
    Left Join Party as party1 on self.party = party1.id
    WHERE
        party1.isCustomer = true AND self.status != 'Paid' AND 
        self.dateT BETWEEN :fromDateTime 
        AND :toDateTime GROUP BY party1.name
    ]]>
    </dataset>

    <!-- SELECT count(self.status) as totalStatus self.party.name as customer FROM Invoice as self WHERE 
      self.party.isCustomer = true AND self.status != 'Paid' GROUP BY customer ORDER BY customer -->

    <category key="customer" type="text" />
    <series key="status" groupBy="customer" type="bar" />
  </chart>

  <chart onInit="action-date-time-set-defalut" name="chart-paid-invoice-category-product"
    title="Paid Invoice Per Category Per Product">
    <search-fields>
      <field type="datetime" name="fromDateTime" title="from Date" />
      <field type="datetime" name="toDateTime" title="To Date" />
    </search-fields>

    <dataset type="jpql">
    <![CDATA[
    SELECT
    count(self.status) as status ,                 
    pro_cat.name as cate,
    prod.name as product_name
    FROM
     Invoice as self ,
     InvoiceLine as line,
     Product as prod,
     ProductCategory as pro_cat
    WHERE
        self.id = line.invoice AND
        line.product = prod AND
        prod.category = pro_cat AND
        self.status = 'Paid' AND
        self.dateT BETWEEN :fromDateTime 
        AND :toDateTime
    group by pro_cat.name ,prod.name
    ]]>
    </dataset>
    
    <!--  SELECT
    count(self.status) as status ,                 
     pro_cat.name as cate,
    product.name as product_name
    FROM
        gst_invoice as self
     left join gst_invoice_line as line on self.id = line.invoice
     left join gst_product as product on line.product = product.id
     left join gst_product_category as pro_cat on product.category = pro_cat.id 
    WHERE
        self.status = 'Paid'     
    group by cate , product_name;  -->

    <category key="cate" type="text" />
    <series key="status" groupBy="product_name" type="bar" />
  </chart>

  <chart name="chart-customer-per-state" title="Customer Per State">
    <dataset type="sql">
    <![CDATA[
  select count(self.id) as customer , 
  state.name as state_name from 
  gst_party as self 
  left join gst_address as add on add.id = any (select gpal.address_list from gst_party_address_list
 as gpal where gpal.gst_party = self.id)  
 right join gst_state as state on add.state = state.id 
 where self.is_customer = 'true' 
 group by state_name;
    ]]>
    </dataset>

    <category key="state_name" type="text" />
    <series key="customer" groupBy="state_name" type="pie" />
  </chart>



  <chart name="chart-invoice-per-status-amount" title="Invoice Per Status For Amount">
    <dataset type="sql">
    <![CDATA[
  select sum(self.gross_amount) as amount , self.status as status from gst_invoice as self group by status;
    ]]>
    </dataset>

    <category key="status" type="text" />
    <series key="amount" groupBy="status" type="bar" />
  </chart>

  <chart name="chart-invoice-per-status-number-of-invoice" title="Invoice Per Status For Number Of Invoice">
    <dataset type="sql">
    <![CDATA[
  select count(self.id) as number , self.status as status from gst_invoice as self group by status;
    ]]>
    </dataset>

    <category key="status" type="text" />
    <series key="number" groupBy="status" type="line" />
  </chart>

  <action-attrs name="action-date-time-set-defalut">
    <attribute name="value" for="toDateTime" expr="eval: __datetime__" />
    <attribute name="value" for="fromDateTime" expr="eval:__date__.withDayOfMonth(1)" />
  </action-attrs>

</object-views>
